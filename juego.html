<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game</title>
    <script src="https://kit.fontawesome.com/d4b8af33ac.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/estilosJuego.css">
    <script src="js/juego.js"></script>
    <link rel="shortcut icon" href="img/Extras/logo.png" type="image/x-icon">

</head>

<body>
    <div class="tablas">
        <div class="worldList">
            <script>
                // Crear una instancia de XMLHttpRequest
                var xhr = new XMLHttpRequest();
                // Configurar la solicitud
                xhr.open('GET', "AJAX/worldListTable.php", true);
                // Configurar la respuesta
                xhr.onload = function () {
                    if (this.status === 200) {
                        // Convertir la respuesta en un objeto JavaScript
                        var usuarios = JSON.parse(this.responseText);
                        // Crear la tabla
                        var tabla = '<table>';
                        tabla += "<tr><th colspan='3'>Record mundial</th></tr>";
                        tabla += "<tr><th>Nombre de usuario</th><th>Puntaje máximo</th></tr>";
                        for (var i = 0; i < usuarios.length; i++) {
                            tabla += '<tr><td>' + usuarios[i].Nombre_de_usuario + '</td><td>' + usuarios[i].Maximo_puntaje + '</td></tr>';
                        }
                        tabla += '</table>';
                        // Imprimir la tabla en el elemento con la clase 'worldList'
                        document.querySelector('.worldList').innerHTML = tabla;
                    }
                };
                // Enviar la solicitud
                xhr.send();
            </script>

        </div>

        <div class="localList">
            <script>
                // Se obtienen los datos del localstorage
                var datos = JSON.parse(localStorage.getItem('usuarios'));
                // Se ordenan por puntaje máximo
                datos.sort(function (a, b) {
                    return b.puntajeMax - a.puntajeMax;
                });

                var tabla = '<table>';
                tabla += "<tr><th colspan='3'>Puntuacion local</th></tr>";
                tabla += "<tr><th>Nombre de usuario</th><th>Puntaje máximo</th><th>Mejor Tiempo</th></tr>";
                for (var i = 0; i < 5; i++) {
                    console.log(datos[i]);
                    if (typeof datos[i] === 'undefined') {
                        break;
                    }
                    tabla += '<tr>';
                    tabla += '<td>' + datos[i]['usuario'] + '</td>';
                    tabla += '<td>' + datos[i]['puntajeMax'] + '</td>';
                    tabla += '<td>' + datos[i]['mejorTiempo'] + '</td>';
                    tabla += '</tr>';
                }
                tabla += '</table>';
                document.querySelector('.localList').innerHTML = tabla;
            </script>
        </div>
    </div>


    <div id="containerAnimales">
        <section id="animal1">
            <img id="imagen1" src="" alt="Animal 1">
        </section>
        <section id="animal2">
            <img id="imagen2" src="" alt="Animal 2">
        </section>
        <section id="animal3">
            <img id="imagen3" src="" alt="Animal 3">
        </section>
    </div>

    <div class="container">
        <section id="canvas1">
            <canvas id="lienzo1"></canvas>
        </section>
        <section id="canvas2">
            <canvas id="lienzo2"></canvas>
        </section>
        <section id="canvas3">
            <canvas id="lienzo3"></canvas>
        </section>
    </div>
    <div class="miscelaneos">
        <div id="timer">00:00</div>
        <br>
        <div id="puntaje">0</div>
    </div>

    <!-- <button id="botonfin" onclick="location.href='fin.html?jugador='+encodeURIComponent(JSON.parse(localStorage.getItem('usuarios'))[0]?.usuario || '');">Salir <i class="fa-solid fa-forward-step" style="color: #FFD43B;"></i></button> -->

    <button id="botonfin" onclick="redirigirConParametro();">Salir <i class="fa-solid fa-forward-step" style="color: #FFD43B;"></i></button>

    <script>
    function redirigirConParametro() {
        // Obtén el arreglo de usuarios desde localStorage
        var usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
        // Verifica si hay al menos un usuario en el arreglo
        if (usuarios.length > 0) {
            // Obtén el usuario actual (por ejemplo, el último usuario en el arreglo)
            var usuarioActual = usuarios[usuarios.length - 1].usuario;
            // Redirige a la página 'fin.html' con el usuario actual como parámetro
            window.location.href = 'fin.html?jugador=' + encodeURIComponent(usuarioActual);
        } else {
            alert('No hay usuarios en el arreglo almacenado en localStorage.');
        }
    }
    </script>

</body>

</html>